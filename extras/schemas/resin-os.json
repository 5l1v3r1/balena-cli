{
    "reconfix": {
        "targets": {
            "config_json": {
                "type": "file",
                "format": "json",
                "location": {
                    "partition": 1,
                    "path": "/config.json"
                }
            },
            "resin_wifi": {
                "type": "file",
                "format": "ini",
                "location": {
                    "partition": 1,
                    "path": "/system-connections/resin-wifi"
                }
            }
        }
    },
    "properties": {
        "persistentLogging": {
            "type": "boolean",
            "reconfix": {
                "transforms": [
                    {
                        "output": {
                            "target": "config_json",
                            "path": "/persistentLogging"
                        }
                    }
                ]
            }
        },
        "hostname": {
            "type": "string",
            "reconfix": {
                "transforms": [
                    {
                        "output": {
                            "target": "config_json",
                            "path": "/hostname"
                        }
                    }
                ]
            }
        },
        "aplication": {
            "type": "object",
            "required": ["name", "id"],
            "properties": {
                "name": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "config_json",
                                    "path": "/applicationName"
                                }
                            }
                        ]
                    }
                },
                "id": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "config_json",
                                    "path": "/applicationId"
                                }
                            }
                        ]
                    }
                }
            }
        },
        "deviceType": {
            "type": "string",
            "reconfix": {
                "transforms": [
                    {
                        "output": {
                            "target": "config_json",
                            "path": "/deviceType"
                        }
                    }
                ]
            }
        },
        "userId": {
            "type": "string",
            "reconfix": {
                "transforms": [
                    {
                        "output": {
                            "target": "config_json",
                            "path": "/userId"
                        }
                    }
                ]
            }
        },
        "appUpdatePollInterval": {
            "type": "string",
            "reconfix": {
                "transforms": [
                    {
                        "output": {
                            "target": "config_json",
                            "path": "/appUpdatePollInterval"
                        }
                    }
                ]
            }
        },
        "listenPort": {
            "type": "string",
            "reconfix": {
                "transforms": [
                    {
                        "output": {
                            "target": "config_json",
                            "path": "/listenPort"
                        }
                    }
                ]
            }
        },
        "mixpanelToken": {
            "type": "string",
            "reconfix": {
                "transforms": [
                    {
                        "output": {
                            "target": "config_json",
                            "path": "/mixpanelToken"
                        }
                    }
                ]
            }
        },
        "vpn": {
            "type": "object",
            "required": ["port", "endpoint"],
            "properties": {
                "port": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "config_json",
                                    "path": "/vpnPort"
                                }
                            }
                        ]
                    }
                },
                "endpoint": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "config_json",
                                    "path": "/vpnEndpoint"
                                }
                            }
                        ]
                    }
                }
            }
            
        },
        "supervisor": {
            "type": "object",
            "required": ["apiEndpoint", "registryEndpoint", "deltaEndpoint", "apiKey"],
            "properties": {
                "apiEndpoint": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "config_json",
                                    "path": "/apiEndpoint"
                                }
                            }
                        ]
                    }
                },
                "registryEndpoint": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "config_json",
                                    "path": "/registryEndpoint"
                                }
                            }
                        ]
                    }
                },
                "deltaEndpoint": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "config_json",
                                    "path": "/deltaEndpoint"
                                }
                            }
                        ]
                    }
                },
                "apiKey": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "config_json",
                                    "path": "/apiKey"
                                }
                            }
                        ]
                    }
                }
            }
        },
        "pubnub": {
            "type": "object",
            "required": ["publishKey", "subscribeKey"],
            "properties": {
                "publishKey": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "config_json",
                                    "path": "/pubnubPublishKey"
                                }
                            }
                        ]
                    }
                },
                "subscribeKey": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "config_json",
                                    "path": "/pubnubSubscribeKey"
                                }
                            }
                        ]
                    }
                }
            }
        },
        "wifi": {
            "properties": {
                "networkSsid": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "resin_wifi",
                                    "path": "/wifi/ssid"
                                }
                            }
                        ]
                    }
                },
                "networkKey": {
                    "type": "string",
                    "reconfix": {
                        "transforms": [
                            {
                                "output": {
                                    "target": "resin_wifi",
                                    "path": "/wifi-security/psk"
                                }
                            }
                        ]
                    }
                },
                "enable": {
                    "type": "boolean",
                    "reconfix": {
                        "transforms": [
                            {
                                "map": [
                                    [true, {
                                        "type": "object",
                                        "required": ["connection", "wifi", "wifi-security", "ipv4", "ipv6"],
                                        "properties": {
                                            "connection": {
                                                "type": "object",
                                                "required": ["id", "type"],
                                                "properties": {
                                                    "id": { "const": "resin-wifi-01" },
                                                    "type": { "const": "wifi" }
                                                }
                                            },
                                            "wifi": {
                                                "type": "object",
                                                "required": ["mode", "ssid"],
                                                "properties": {
                                                    "mode": { "const": "infrastructure" },
                                                    "ssid": { "type": "string" }
                                                }
                                            },
                                            "wifi-security": {
                                                "type": "object",
                                                "required": ["auth-alg", "key-mgmt", "psk"],
                                                "properties": {
                                                    "auth-alg": { "const": "open" },
                                                    "key-mgmt": { "const": "wpa-psk" },
                                                    "psk": { "const": "string" }
                                                }
                                            },
                                            "ipv4": {
                                                "type": "object",
                                                "required": ["method"],
                                                "properties": {
                                                    "method": { "const": "auto" }
                                                }
                                            },
                                            "ipv6": {
                                                "type": "object",
                                                "required": ["addr-gen-mode", "method"],
                                                "properties": {
                                                    "addr-gen-mode": { "const": "stable-privacy" },
                                                    "method": { "const": "auto" }
                                                }
                                            }
                                        }
                                    }],
                                    [false, { "const": null }]
                                ],
                                "output": {
                                    "target": "resin_wifi",
                                    "path": ""
                                }
                            }
                        ]
                    }
                }
            }
        }
    }
}